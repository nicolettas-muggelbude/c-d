<?php
/**
 * Konfigurationsdatei
 * PC-Wittfoot
 *
 * WICHTIG: Diese Datei NICHT in Git committen!
 * Enthält sensible Zugangsdaten.
 */

// =============================================
// UMGEBUNG
// =============================================

// Produktionsmodus (auf Server: true)
define('PRODUCTION_MODE', false);

// Error Reporting
error_reporting(E_ALL);
if (PRODUCTION_MODE) {
    // Produktion: Fehler nur loggen, nicht anzeigen
    ini_set('display_errors', 0);
    ini_set('display_startup_errors', 0);
} else {
    // Entwicklung: Fehler anzeigen
    ini_set('display_errors', 1);
    ini_set('display_startup_errors', 1);
}
ini_set('log_errors', 1);
ini_set('error_log', dirname(dirname(__DIR__)) . '/logs/error.log');

// Timezone
date_default_timezone_set('Europe/Berlin');

// =============================================
// DATENBANK-KONFIGURATION
// =============================================

define('DB_HOST', 'sql116.c.artfiles.de');
define('DB_NAME', 'db285520001');
define('DB_USER', 'db285520001');    // Eigener User
define('DB_PASS', 'pcwPCW2026!!');         // Passwort (ÄNDERN in Produktion!)
define('DB_CHARSET', 'utf8mb4');

// =============================================
// PFADE
// =============================================

define('BASE_PATH', dirname(__DIR__));          // /src
define('CORE_PATH', BASE_PATH . '/core');
define('ASSETS_PATH', BASE_PATH . '/assets');
define('UPLOADS_PATH', BASE_PATH . '/uploads');
define('CACHE_PATH', BASE_PATH . '/cache');

// URL-Basis (anpassen für Produktion)
define('BASE_URL', 'https://pc-wittfoot.de');
define('ASSETS_URL', BASE_URL . '/assets');
define('UPLOADS_URL', BASE_URL . '/uploads');

// =============================================
// SICHERHEIT
// =============================================

// Session-Einstellungen
ini_set('session.cookie_httponly', 1);
ini_set('session.use_only_cookies', 1);
ini_set('session.cookie_samesite', 'Lax');

// Secure Cookie nur über HTTPS (in Produktion)
if (PRODUCTION_MODE && (!empty($_SERVER['HTTPS']) || $_SERVER['SERVER_PORT'] == 443)) {
    ini_set('session.cookie_secure', 1);
}

// Session-Lifetime (12 Stunden)
ini_set('session.gc_maxlifetime', 43200);
ini_set('session.cookie_lifetime', 43200);

// CSRF-Token Secret (in Produktion durch echten Random-String ersetzen!)
define('CSRF_SECRET', PRODUCTION_MODE ?
    getenv('CSRF_SECRET') ?: 'CHANGE_THIS_TO_RANDOM_STRING' :
    'dev_secret_' . md5(BASE_PATH)
);

// Session-Name
define('SESSION_NAME', 'pc_wittfoot_session');

// =============================================
// SHOP-EINSTELLUNGEN
// =============================================

define('CURRENCY', '€');
define('CURRENCY_CODE', 'EUR');
define('TAX_RATE', 0.19);  // 19% MwSt.

// =============================================
// E-MAIL-KONFIGURATION
// =============================================

define('MAIL_FROM', 'info@pc-wittfoot.de');
define('MAIL_FROM_NAME', 'PC-Wittfoot UG');
define('MAIL_ADMIN', 'admin@pc-wittfoot.de');

// SMTP-Einstellungen (PHPMailer)
define('SMTP_ENABLED', false);                    // true = SMTP verwenden, false = PHP mail()
define('SMTP_HOST', 'smtp.gmail.com');            // SMTP Server
define('SMTP_PORT', 587);                         // Port (587 = TLS, 465 = SSL)
define('SMTP_ENCRYPTION', 'tls');                 // 'tls' oder 'ssl'
define('SMTP_USERNAME', '');                      // SMTP Benutzername
define('SMTP_PASSWORD', '');                      // SMTP Passwort
define('SMTP_DEBUG', 0);                          // 0 = aus, 1 = Fehler, 2 = verbose

// =============================================
// API-KEYS (für Produktion ausfüllen)
// =============================================

// Google Places API (für Reviews)
define('GOOGLE_PLACES_API_KEY', '');

// hellocash API
define('HELLOCASH_API_KEY', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE3NjcyMjgyOTkuNzE2OTk3LCJjcmlkIjoiMjIxODM0In0.9RFUF-Fgo32eNmjREIkUY7WW_abdkWQEMbTd6gg9u8Y');
define('HELLOCASH_API_URL', 'https://api.hellocash.business/api/v1/');
define('HELLOCASH_LANDLINE_FIELD', 'Festnetz'); // Name des Custom Fields für Festnetznummer

// PayPal
define('PAYPAL_CLIENT_ID', '');
define('PAYPAL_SECRET', '');
define('PAYPAL_MODE', 'sandbox');  // 'sandbox' oder 'live'

// SumUp
define('SUMUP_APP_ID', '');
define('SUMUP_APP_SECRET', '');

// =============================================
// VERSCHIEDENES
// =============================================

// Debug-Modus (NUR in Entwicklung!)
define('DEBUG_MODE', true);

// Produkte pro Seite
define('PRODUCTS_PER_PAGE', 12);

// Blog-Posts pro Seite
define('POSTS_PER_PAGE', 10);

// Cache-Laufzeiten (in Sekunden)
define('CACHE_REVIEWS', 86400);      // 24 Stunden
define('CACHE_PRODUCTS', 3600);      // 1 Stunde
define('CACHE_PAGES', 7200);         // 2 Stunden

// =============================================
// AUTO-LOADING
// =============================================

// Composer Autoload (für PHPMailer & andere Packages)
require_once dirname(dirname(__DIR__)) . '/vendor/autoload.php';

// Autoload-Funktion für Klassen
spl_autoload_register(function($class) {
    $paths = [
        CORE_PATH . '/' . $class . '.php',
        BASE_PATH . '/shop/classes/' . $class . '.php',
        BASE_PATH . '/admin/classes/' . $class . '.php',
    ];

    foreach ($paths as $path) {
        if (file_exists($path)) {
            require_once $path;
            return;
        }
    }
});

// =============================================
// CORE-DATEIEN LADEN
// =============================================

require_once CORE_PATH . '/helpers.php';
require_once CORE_PATH . '/database.php';

require_once CORE_PATH . '/Security.php';
require_once CORE_PATH . '/DeviceFingerprint.php';

// Security-Headers setzen
if (class_exists('Security')) {
    $security = new Security();
    $security->setSecurityHeaders();
}
